<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capacitaci√≥n | Sistema MEAL +PaZion</title>
    <link rel="stylesheet" href="css/main.css?v=8">
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap"
        rel="stylesheet">
    <style>
        .podcast-header {
            background: linear-gradient(135deg, var(--purple-600), #581c87);
            border-radius: var(--radius-xl);
            padding: var(--space-2xl);
            color: white;
            display: flex;
            align-items: center;
            gap: var(--space-xl);
            box-shadow: 0 10px 25px -5px rgba(123, 53, 196, 0.4);
            position: relative;
            overflow: hidden;
            margin-bottom: var(--space-2xl);
        }

        .podcast-header::before {
            content: '';
            position: absolute;
            top: -50px;
            right: -50px;
            width: 250px;
            height: 250px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 70%);
            border-radius: 50%;
        }

        .podcast-cover {
            width: 160px;
            height: 160px;
            border-radius: var(--radius-lg);
            background: #1e1b4b;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 64px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            border: 4px solid rgba(255, 255, 255, 0.1);
        }

        .podcast-info {
            flex: 1;
            z-index: 1;
        }

        .podcast-badge {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(4px);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: inline-block;
            margin-bottom: var(--space-sm);
        }

        .podcast-title {
            font-family: 'Outfit', sans-serif;
            font-size: 32px;
            font-weight: 800;
            margin-bottom: var(--space-xs);
            line-height: 1.2;
        }

        .podcast-meta {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        /* Reproductor de Audio Custom */
        .audio-player {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            padding: 12px 24px;
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-top: var(--space-lg);
        }

        .btn-play {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: white;
            color: var(--purple-600);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            flex-shrink: 0;
        }

        .btn-play:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.3);
        }

        .progress-bar {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
        }

        .progress-fill {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: white;
            border-radius: 3px;
            width: 0%;
        }

        .progress-handle {
            position: absolute;
            right: -6px;
            top: -3px;
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .progress-bar:hover .progress-handle {
            opacity: 1;
        }

        .time-display {
            font-size: 13px;
            font-variant-numeric: tabular-nums;
            opacity: 0.9;
            min-width: 45px;
            text-align: right;
        }

        /* Notas del Episodio */
        .show-notes {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
        }

        .timestamp {
            display: inline-block;
            background: rgba(123, 53, 196, 0.1);
            color: var(--purple-400);
            padding: 2px 8px;
            border-radius: 4px;
            font-variant-numeric: tabular-nums;
            font-weight: 600;
            font-size: 13px;
            margin-right: var(--space-sm);
            cursor: pointer;
            transition: background 0.2s;
        }

        .timestamp:hover {
            background: rgba(123, 53, 196, 0.2);
        }

        .note-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: var(--space-md);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--border);
        }

        .note-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .note-content {
            flex: 1;
        }

        .note-content h4 {
            margin: 0 0 4px 0;
            font-size: 16px;
            color: var(--text-primary);
        }

        .note-content p {
            margin: 0;
            font-size: 14px;
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .podcast-header {
                flex-direction: column;
                text-align: center;
                padding: var(--space-lg);
            }

            .podcast-meta {
                justify-content: center;
            }

            .audio-player {
                padding: 12px;
                gap: 12px;
            }
        }
    </style>
</head>

<body>
    <div class="app-layout">
        <aside class="sidebar"></aside>

        <main class="main-content">
            <header class="topbar"></header>

            <div class="page-wrapper">
                <!-- Header del Podcast -->
                <div class="podcast-header">
                    <div class="podcast-cover">
                        üéß
                    </div>
                    <div class="podcast-info">
                        <span class="podcast-badge">Episodio 1</span>
                        <h1 class="podcast-title">Gu√≠a de Inicio: Captura de Datos en Campo</h1>
                        <div class="podcast-meta">
                            <span>üéôÔ∏è Voces de +PaZion</span>
                            <span>‚è≥ 5:30 min</span>
                            <span>üìÖ Febrero 2026</span>
                        </div>
                        <p style="opacity: 0.9; max-width: 600px; font-size: 15px; margin: 0;">
                            Aprende todo lo necesario para utilizar la Matriz de Monitoreo MEAL. Desde c√≥mo seleccionar
                            indicadores hasta la sincronizaci√≥n de datos sin conexi√≥n a internet.
                        </p>

                        <!-- Reproductor de Audio (Modo Demo/Simulador) -->
                        <div class="audio-player">
                            <button class="btn-play" id="btnPlayPause">
                                ‚ñ∂
                            </button>
                            <span class="time-display" id="currentTime">0:00</span>
                            <div class="progress-bar" id="progressBar">
                                <div class="progress-fill" id="progressFill"></div>
                                <div class="progress-handle" id="progressHandle"></div>
                            </div>
                            <span class="time-display" id="durationTime">5:30</span>

                            <!-- Control de Volumen (Decorativo) -->
                            <div class="volume-container"
                                style="display: flex; align-items: center; gap: 8px; margin-left: 12px; padding-left: 12px; border-left: 1px solid rgba(255,255,255,0.2);">
                                <span id="btnMute" style="cursor: pointer; font-size: 16px;">üîä</span>
                                <input type="range" id="volumeSlider" min="0" max="1" step="0.05" value="1"
                                    style="width: 60px; height: 4px; accent-color: white; cursor: pointer;">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notas del Episodio -->
                <div class="grid grid-2" style="align-items: start; gap: var(--space-xl);">

                    <div class="show-notes">
                        <h3 style="margin-bottom: var(--space-lg); display: flex; align-items: center; gap: 8px;">
                            üìã Notas del Episodio
                        </h3>

                        <div class="note-item">
                            <span class="timestamp" data-time="0">0:00</span>
                            <div class="note-content">
                                <h4>Bienvenida y Conceptos B√°sicos</h4>
                                <p>Introducci√≥n al sistema MEAL (Monitoreo, Evaluaci√≥n, Aprendizaje y L√≥gica) y por qu√©
                                    es vital para el programa "Goles de Vida".</p>
                            </div>
                        </div>

                        <div class="note-item">
                            <span class="timestamp" data-time="45">0:45</span>
                            <div class="note-content">
                                <h4>Paso 1: Seleccionando el Eje y el Indicador</h4>
                                <p>C√≥mo navegar por los distintos ejes estrat√©gicos (Empoderamiento, Construcci√≥n de
                                    Paz, Permanencia Deportiva) y seleccionar el indicador correcto para la sesi√≥n del
                                    d√≠a.</p>
                            </div>
                        </div>

                        <div class="note-item">
                            <span class="timestamp" data-time="120">2:00</span>
                            <div class="note-content">
                                <h4>Paso 2: Tipos de Encuestas</h4>
                                <p>Explicaci√≥n pr√°ctica de las encuestas de escala (1 al 10), encuestas de respuesta
                                    directa (S√≠/No) y c√≥mo registrar el conteo para torneos o encuentros
                                    interculturales.</p>
                            </div>
                        </div>

                        <div class="note-item">
                            <span class="timestamp" data-time="210">3:30</span>
                            <div class="note-content">
                                <h4>Paso 3: Evidencia y Firma</h4>
                                <p>La importancia del bot√≥n de GPS, c√≥mo cargar la foto de asistencia y el uso del
                                    lienzo para la firma digital del t√©cnico responsable.</p>
                            </div>
                        </div>

                        <div class="note-item">
                            <span class="timestamp" data-time="270">4:30</span>
                            <div class="note-content">
                                <h4>Trabajando Sin Internet (Offline-First)</h4>
                                <p>¬øFuiste a una comunidad sin se√±al? No te preocupes. Explicamos c√≥mo el sistema guarda
                                    todo en tu dispositivo y c√≥mo usar el bot√≥n "Sincronizar" al volver a la oficina.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Recursos Adicionales -->
                    <div>
                        <div class="card" style="margin-bottom: var(--space-lg);">
                            <h3 style="margin-bottom: var(--space-md);">üìö Recursos Adicionales</h3>
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                <li style="margin-bottom: 12px;">
                                    <a href="#" class="text-gradient fw-600"
                                        style="display: flex; align-items: center; gap: 8px;">
                                        <span>üìÑ</span> Descargar Gu√≠a R√°pida (PDF)
                                    </a>
                                </li>
                                <li style="margin-bottom: 12px;">
                                    <a href="#" class="text-gradient fw-600"
                                        style="display: flex; align-items: center; gap: 8px;">
                                        <span>üìä</span> Cat√°logo de Indicadores MEAL
                                    </a>
                                </li>
                                <li>
                                    <a href="#" class="text-gradient fw-600"
                                        style="display: flex; align-items: center; gap: 8px;">
                                        <span>üìû</span> Contactar Soporte T√©cino
                                    </a>
                                </li>
                            </ul>
                        </div>

                        <div class="alert alert-info" style="margin: 0;">
                            <strong>üí° Tip:</strong> Puedes escuchar este audio mientras te desplazas hacia la
                            comunidad. La p√°gina web seguir√° reproduci√©ndolo en segundo plano en tu celular.
                        </div>
                    </div>

                </div>
            </div>
        </main>
    </div>

    <script type="module">
        import { initUI } from './js/app.js?v=999';

        // Inicializar barra lateral y superior de forma segura
        document.addEventListener('DOMContentLoaded', () => {
            initUI();

            // --- L√≥gica del Reproductor con Sintetizador de Voz Nativo ---
            const btnPlayPause = document.getElementById('btnPlayPause');
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            const currentTimeEl = document.getElementById('currentTime');

            let isPlaying = false;
            let currentSeconds = 0;
            const totalDuration = 180; // 3 minutos aprox del guion
            let progressInterval = null;
            let currentUtterance = null;

            // Textos del podcast
            const podcastScript = [
                { time: 0, text: "Bienvenido a la Gu√≠a de Inicio de la Matriz de Monitoreo Mil. En este episodio de Voces de Pasi√≥n, aprenderemos a utilizar el sistema de captura de datos." },
                { time: 15, text: "Paso uno: Seleccionando el Eje y el Indicador. Para comenzar, navega por los ejes estrat√©gicos, como Empoderamiento, Construcci√≥n de Paz o Permanencia Deportiva." },
                { time: 30, text: "Aseg√∫rate de seleccionar el indicador correcto para la sesi√≥n del d√≠a. De esta manera, mantendremos la informaci√≥n organizada." },
                { time: 45, text: "Paso dos: Tipos de Encuestas. En el sistema encontrar√°s encuestas de escala del uno al diez, y encuestas de respuesta directa de S√≠ o No." },
                { time: 65, text: "Tambi√©n podr√°s registrar conteos r√°pidos para asistencia a torneos o encuentros interculturales." },
                { time: 80, text: "Paso tres: Evidencia y Firma. No olvides activar tu GPS para validar la ubicaci√≥n. Toma la foto de la asistencia y solicita la firma digital en el lienzo." },
                { time: 100, text: "Muy importante: Trabajando sin internet. Si fuiste a una comunidad sin se√±al, no te preocupes." },
                { time: 115, text: "El sistema guarda todos los formularios internamente en tu dispositivo m√≥vil. Cuando regreses a la oficina y tengas internet, simplemente presiona el bot√≥n Sincronizar en la parte superior." },
                { time: 135, text: "Gracias por tu excelente labor t√©cnica en terreno. ¬°Sigamos marcando Goles de Vida!" }
            ];

            let scriptIndex = 0;

            function formatTime(totalSeconds) {
                const mins = Math.floor(totalSeconds / 60);
                const secs = Math.floor(totalSeconds % 60);
                return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            }

            function updatePlayerUI() {
                currentTimeEl.textContent = formatTime(currentSeconds);
                const percent = (currentSeconds / totalDuration) * 100;
                progressFill.style.width = `${percent}%`;
            }

            function getFemaleSpanishVoice() {
                const voices = window.speechSynthesis.getVoices();
                // Buscar voz en espa√±ol femenina (por heur√≠stica de nombre o lang)
                let esVoices = voices.filter(v => v.lang.startsWith('es'));
                if (esVoices.length === 0) return null;

                // Intentar encontrar voces famosas femeninas (Paulina, Monica, Sabina, etc en OS)
                let female = esVoices.find(v => v.name.includes('Monica') || v.name.includes('Paulina') || v.name.includes('Paulina') || v.name.includes('Luciana') || v.name.includes('Margarita'));
                return female || esVoices[0]; // Retorna femenina o la primera en espa√±ol
            }

            function speakNext() {
                if (scriptIndex >= podcastScript.length || !isPlaying) return;

                const part = podcastScript[scriptIndex];
                currentUtterance = new SpeechSynthesisUtterance(part.text);

                const voice = getFemaleSpanishVoice();
                if (voice) currentUtterance.voice = voice;
                currentUtterance.lang = 'es-ES';
                currentUtterance.rate = 0.95; // Un poco m√°s lento, modo locutora
                currentUtterance.pitch = 1.1; // Tono m√°s agudo

                currentUtterance.onend = () => {
                    scriptIndex++;
                    speakNext();
                };

                window.speechSynthesis.speak(currentUtterance);
            }

            function playPodcast() {
                // Prevenir m√∫ltiples instancias
                window.speechSynthesis.cancel();

                // Asegurarse de que el script arranca de cero si termin√≥
                if (currentSeconds >= totalDuration) {
                    currentSeconds = 0;
                    scriptIndex = 0;
                }

                isPlaying = true;
                btnPlayPause.innerHTML = '‚è∏';

                // Iniciar motor de voz
                speakNext();

                // Fake progress visual
                progressInterval = setInterval(() => {
                    if (currentSeconds < totalDuration && isPlaying) {
                        currentSeconds++;
                        updatePlayerUI();
                    } else if (currentSeconds >= totalDuration) {
                        pausePodcast();
                        currentSeconds = 0;
                        updatePlayerUI();
                    }
                }, 1000);
            }

            function pausePodcast() {
                isPlaying = false;
                btnPlayPause.innerHTML = '‚ñ∂';
                clearInterval(progressInterval);
                window.speechSynthesis.pause(); // Pausar voz en progreso
                window.speechSynthesis.cancel(); // Matar pronunciaci√≥n para evitar atascos
            }

            btnPlayPause.addEventListener('click', () => {
                if (isPlaying) pausePodcast();
                else playPodcast();
            });

            // Adelantar haciendo click en la barra
            progressBar.addEventListener('click', (e) => {
                const rect = progressBar.getBoundingClientRect();
                const pos = (e.clientX - rect.left) / rect.width;
                currentSeconds = Math.floor(pos * totalDuration);

                // Mapear segundos a √≠ndice del script
                let newIndex = 0;
                for (let i = podcastScript.length - 1; i >= 0; i--) {
                    if (currentSeconds >= podcastScript[i].time) {
                        newIndex = i;
                        break;
                    }
                }
                scriptIndex = newIndex;

                updatePlayerUI();
                if (isPlaying) {
                    pausePodcast();
                    playPodcast(); // Reinicia la voz desde el nuevo √≠ndice
                }
            });

            // Clic en los timestamps de las notas (salta al tiempo espec√≠fico del di√°logo)
            document.querySelectorAll('.timestamp').forEach(badge => {
                badge.addEventListener('click', () => {
                    const timeStr = badge.dataset.time;
                    if (timeStr) {
                        currentSeconds = parseInt(timeStr, 10);

                        // Encontrar √≠ndice apropiado en script
                        scriptIndex = podcastScript.findIndex(part => part.time === currentSeconds);
                        if (scriptIndex === -1) scriptIndex = 0;

                        updatePlayerUI();

                        if (isPlaying) pausePodcast();
                        playPodcast();

                        // Animaci√≥n interactiva de la nota
                        const noteContent = badge.nextElementSibling;
                        noteContent.style.transition = 'background 0.3s';
                        noteContent.style.background = 'rgba(123, 53, 196, 0.1)';
                        noteContent.style.padding = '8px';
                        noteContent.style.borderRadius = '8px';
                        setTimeout(() => {
                            noteContent.style.background = 'transparent';
                        }, 1500);
                    }
                });
            });

            // Precargar voces
            window.speechSynthesis.onvoiceschanged = () => {
                getFemaleSpanishVoice();
            };
        });
    </script>
</body>

</html>